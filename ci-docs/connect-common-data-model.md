---
title: الاتصال بمجلد نموذج البيانات العامة باستخدام حساب Azure Data Lake
description: اعمل مع بيانات نموذج البيانات العامة باستخدام Azure Data Lake Storage.
ms.date: 09/29/2022
ms.topic: how-to
author: mukeshpo
ms.author: mukeshpo
ms.reviewer: v-wendysmith
manager: shellyha
searchScope:
- ci-data-sources
- ci-create-data-source
- ci-attach-cdm
- customerInsights
ms.openlocfilehash: c12603b9ed8a814356a0f8d0137e97afc749b87c
ms.sourcegitcommit: be341cb69329e507f527409ac4636c18742777d2
ms.translationtype: HT
ms.contentlocale: ar-SA
ms.lasthandoff: 09/30/2022
ms.locfileid: "9609926"
---
# <a name="connect-to-data-in-azure-data-lake-storage"></a>الاتصال بالبيانات في Azure Data Lake Storage

استيعاب البيانات في Dynamics 365 Customer Insights باستخدام حساب Azure Data Lake Storage Gen2. بإمكان استيعاب البيانات أن يكون كاملاً أو تزايديًا.

## <a name="prerequisites"></a>المتطلبات

- يدعم استيعاب البيانات حسابات Azure Data Lake Storage *Gen2* حصريًا. لا يمكنك استخدام حسابات Data Lake Storage Gen1 لاستيعاب البيانات.

- يجب [تمكين مساحة اسم التدرج الهرمي](/azure/storage/blobs/data-lake-storage-namespace) في حسابات Azure Data Lake Storage. يجب تخزين البيانات في تنسيق مجلد هرمي يحدد مجلد الجذر ولديه مجلدات فرعية لكل كيان. بإمكان المجلدات الفرعية أن تتضمن مجلدات بيانات كاملة أو مجلدات بيانات تزايدية.

- للمصادقة مع كيان خدمة Azure، تأكد من تكوينه في المستأجر. لمزيد من المعلومات، راجع [الاتصال بحساب Azure Data Lake Storage Gen2 باستخدام كيان خدمة Azure](connect-service-principal.md).

- يجب أن يكون Azure Data Lake Storage الذي تريد الاتصال به واستيعاب البيانات منه موجوداً في منطقة Azure نفسها حيث بيئة Dynamics 365 Customer Insights. الاتصالات بمجلد نموذج البيانات العامة من مستودع البيانات في منطقة Azure مختلفة غير مدعومة. لمعرفة منطقة Azure للبيئة، انتقل إلى **‏‫مسؤول** > **النظام** > **حول** في Customer Insights.

- قد يتم تخزين البيانات المخزنة في الخدمات عبر الإنترنت في موقع مختلف عن موقع معالجة أو تخزين البيانات في Dynamics 365 Customer Insights. من خلال استيراد البيانات المخزنة في الخدمات عبر الإنترنت أو الاتصال بها، فأنت توافق على نقل هذه البيانات وتخزينها بواسطة Dynamics 365 Customer Insights. [اعرف المزيد في مركز توثيق Microsoft](https://www.microsoft.com/trust-center).

- يجب أن يؤدي كيان خدمة Customer Insights أحد الأدوار التالية للوصول إلى حساب التخزين. لمزيد من المعلومات، راجع [منح أذونات إلى كيان الخدمة للوصول إلى حساب التخزين](connect-service-principal.md#grant-permissions-to-the-service-principal-to-access-the-storage-account).
  - قارئ بيانات مخزن البيانات الثنائية الكبيرة
  - مالك بيانات مخزن البيانات الثنائية الكبيرة
  - المساهم في بيانات مخزن البيانات الثنائية الكبيرة

- يحتاج المستخدم الذي يقوم بإعداد اتصال مصدر البيانات إلى ‏‫المساهم في بيانات مخزن البيانات الثنائية الكبيرة على حساب التخزين.

- يجب أن تتبع البيانات الموجودة في Data Lake Storage مقياس نموذج البيانات العامة لتخزين بياناتك كما يجب أن يكون لديها بيان نموذج البيانات العامة لتمثيل مخطط ملفات البيانات (csv.* أو parquet.*). يجب أن يقدم البيان تفاصيل الكيانات مثل أعمدة الكيانات وأنواع البيانات، وموقع ملف البيانات ونوع الملف. للحصول على المزيد من المعلومات، راجع [بيان نموذج البيانات العامة](/common-data-model/sdk/manifest). إذا لم يكن البيان موجودًا، فبإمكان المستخدمين الذين لديهم دور المسؤول وحق الوصول كمالك بيانات مخزن البيانات الثنائية الكبيرة أو مساهم بيانات مخزن البيانات الثنائية الكبيرة تعريف المخطط عند استيعاب البيانات.

## <a name="recommendations"></a>التوصيات

للحصول على الأداء الأمثل، ينصح Customer Insights بأن يكون حجم القسم 1 غيغابايت أو أقل ويجب ألا يتجاوز عدد ملفات الأقسام في المجلد 1000.

## <a name="connect-to-azure-data-lake-storage"></a>الاتصال بـ Azure Data Lake Storage

1. انتقل إلى **البيانات** > **مصادر البيانات**.

1. حدد **إضافة مصدر بيانات**.

1. حدد **Azure Data Lake Storage**.

   :::image type="content" source="media/data_sources_ADLS.png" alt-text="مربع حوار لإدخال تفاصيل الاتصال لـ Azure Data Lake." lightbox="media/data_sources_ADLS.png":::

1. أدخل **اسمًا** لمصدر البيانات و **وصفًا** اختياريًا. يحدد الاسم بشكل فريد مصدر البيانات ويُشار إليه في عمليات المرحلة النهائية ولا يمكن تغييره.

1. حدد أحد الخيارات التالية **لتوصيل مساحة التخزين باستخدام** لمزيد من المعلومات، راجع [توصيل Customer Insights بحساب Azure Data Lake Storage Gen2 باستخدام كيان خدمة Azure](connect-service-principal.md).

   - **مورد Azure**: أدخل **معرف المورد**. بشكل اختياري، إذا أردت استيعاب البيانات من حساب تخزين عبر Azure Private Link، فحدد **تمكين الارتباط الخاص**. لمزيد من المعلومات، راجع [الارتباطات الخاصة](security-overview.md#set-up-an-azure-private-link).
   - **اشتراك Azure**: حدد **الاشتراك** ثم **مجموعة الموارد** و **حساب التخزين**. بشكل اختياري، إذا أردت استيعاب البيانات من حساب تخزين عبر Azure Private Link، فحدد **تمكين الارتباط الخاص**. لمزيد من المعلومات، راجع [الارتباطات الخاصة](security-overview.md#set-up-an-azure-private-link).
  
   > [!NOTE]
   > أنت تحتاج إلى أحد الأدوار التالية للحاوية أو حساب التخزين لإنشاء مصدر البيانات:
   >
   >  - دور قارئ بيانات تخزين البيانات الثنائية الكبيرة يكفي لقراءة البيانات من حساب التخزين واستيعاب البيانات من Customer Insights.
   >  - دور مساهم بيانات مخزن البيانات الثنائية الكبيرة أو المالك مطلوب إذا أردت تحرير ملفات البيانات مباشرةً في Customer Insights.  
  
1. اختر اسم **الحاوية** التي تحتوي على البيانات أو المخطط (ملف model.json أو manifest.json) لاستيراد البيانات منه، ثم حدد **التالي**.
   > [!NOTE]
   > لن يظهر في القائمة أي ملف model.json أو manifest.json مرتبط بمصدر بيانات آخر في البيئة. ومع ذلك، يمكن استخدام ملف model.json أو manifest.json نفسه لمصادر البيانات في بيئات متعددة.

1. لإنشاء مخطط جديد، انتقل إلى [إنشاء ملف مخطط جديد](#create-a-new-schema-file).

1. لاستخدام مخطط موجود، انتقل إلى المجلد الذي يحتوي على الملف model.json أو manifest.cdm.json. يمكنك البحث داخل دليل للعثور على الملف.

1. حدد ملف json، ثم حدد **التالي**. تظهر قائمة تتضمن الكيانات المتوفرة.

   :::image type="content" source="media/review-entities.png" alt-text="مربع حوار قائمة كيانات للتحديد منها":::

1. حدد الكيانات التي تريد تضمينها.

   :::image type="content" source="media/ADLS_required.png" alt-text="مربع حوار يعرض الخيار مطلوب للمفتاح الأساسي":::

   > [!TIP]
   > لتحرير كيان في واجهة تحرير JSON، حدد الكيان ثم قم **بتحرير ملف المخطط**. أدخل التغييرات وحدد **حفظ**.

1. بالنسبة للكيانات المحددة التي تتطلب الاستيعاب التزايدي، يظهر **مطلوب** تحت **تحديث تزايدي**. لكل واحد من هذه الكيانات، راجع [تكوين تحديث تزايدي لمصادر بيانات Azure Data Lake](incremental-refresh-data-sources.md).

1. بالنسبة للكيانات المحددة حيث لم يتم تحديد مفتاح أساسي، يظهر **مطلوب** تحت **المفتاح الأساسي**. لكل واحد من هذه الكيانات:
   1. حدد **مطلوب**. تظهر لوحة **تحرير الكيان**.
   1. اختر **المفتاح الأساسي**. المفتاح الأساسي هو سمة فريدة للكيان. كي تكون سمة مفتاحًا أساسيًا صالحًا، يجب ألا تتضمن قيمًا مكررة أو قيمًا مفقودة أو قيمًا فارغة. يتم دعم سمات نوع البيانات سلسلة وعدد صحيح وGUID كمفاتيح أساسية.
   1. بشكل اختياري، غيّر نمط التقسيم‬.
   1. حدد **إغلاق** لحفظ اللوحة وإغلاقها.

1. حدد عدد **السمات** لكل كيان مضمن. تظهر صفحة **إدارة‏‎ السمات**.

   :::image type="content" source="media/dataprofiling-entities.png" alt-text="مربع حوار لتحديد تجميع البيانات‬.":::

   1. أنشئ سمات جديدة أو قم بتحرير أو حذف سمات موجودة. يمكنك تغيير الاسم أو تنسيق البيانات أو إضافة نوع دلالي.
   1. لتمكين التحليلات والقدرات الأخرى، حدد **تجميع البيانات** للكيان بأكمله أو لسمات محددة. بشكل افتراضي، لا يتم تمكين أي كيان لتعريف البيانات.
   1. حدِّد **تم**.

1. حدد **حفظ.**. تفتح صفحة **مصادر‏‎ البيانات** التي تعرض مصدر البيانات الجديد في الحالة **جارٍ التحديث**.

   [!INCLUDE [progress-details-include](includes/progress-details-pane.md)]

قد يستغرق تحميل البيانات وقتا. بعد الانتهاء من التحديث بنجاح، يُمكنك مراجعة البيانات المستوعبة من صفحة [**الكيانات**](entities.md).

### <a name="create-a-new-schema-file"></a>إنشاء ملف مخطط جديد

1. حدد **ملف مخطط جديد**.

1. أدخِل اسمًا للملف، ثم حدد **حفظ**.

1. حدد **كيان جديد**. تظهر لوحة **كيان جديد**.

1. أدخل اسم الكيان، واختر **موقع ملفات البيانات**.
   - **ملفات csv. أو parquet. متعددة**: استعرض وصولاً إلى المجلد الجذر، وحدد نوع النمط، ثم أدخل التعبير.
   - **ملفات csv. أو parquet. فردية**: استعرض وصولاً إلى ملف csv. أو parquet. وحدده.

   :::image type="content" source="media/ADLS_new_entity_location.png" alt-text="مربع حوار لإنشاء كيان جديد مع تمييز موقع ملفات البيانات.":::

1. حدد **حفظ.**.

   :::image type="content" source="media/ADLS_new_entity_define_attributes.png" alt-text="مربع الحوار لتحديد السمات أو إنشائها تلقائيًا.":::

1. حدد **تعريف السمات** لإضافة السمات يدويًا، أو حدد **إنشاء تلقائي لها**. لتعريف السمات، أدخل اسمًا، وحدد تنسيق البيانات والنوع الدلالي الاختياري. للسمات التي تنشأ تلقائيًا:

   1. بعد إنشاء السمات تلقائيًا، حدد **مراجعة السمات**. تظهر صفحة **إدارة‏‎ السمات**.

   1. التأكد من أن تنسيق البيانات صحيح لكل سمة.

   1. لتمكين التحليلات والقدرات الأخرى، حدد **تجميع البيانات** للكيان بأكمله أو لسمات محددة. بشكل افتراضي، لا يتم تمكين أي كيان لتعريف البيانات.

      :::image type="content" source="media/dataprofiling-entities.png" alt-text="مربع حوار لتحديد تجميع البيانات‬.":::

   1. حدِّد **تم**. تظهر الصفحة **تحديد الكيانات**.

1. تابع إضافة كيانات وسمات، إن أمكن.

1. بعد إضافة جميع الكيانات، حدد **تضمين** لتضمين الكيانات في استيعاب مصدر البيانات.

   :::image type="content" source="media/ADLS_required.png" alt-text="مربع حوار يعرض الخيار مطلوب للمفتاح الأساسي":::

1. بالنسبة للكيانات المحددة التي تتطلب الاستيعاب التزايدي، يظهر **مطلوب** تحت **تحديث تزايدي**. لكل واحد من هذه الكيانات، راجع [تكوين تحديث تزايدي لمصادر بيانات Azure Data Lake](incremental-refresh-data-sources.md).

1. بالنسبة للكيانات المحددة حيث لم يتم تحديد مفتاح أساسي، يظهر **مطلوب** تحت **المفتاح الأساسي**. لكل واحد من هذه الكيانات:
   1. حدد **مطلوب**. تظهر لوحة **تحرير الكيان**.
   1. اختر **المفتاح الأساسي**. المفتاح الأساسي هو سمة فريدة للكيان. كي تكون سمة مفتاحًا أساسيًا صالحًا، يجب ألا تتضمن قيمًا مكررة أو قيمًا مفقودة أو قيمًا فارغة. يتم دعم سمات نوع البيانات سلسلة وعدد صحيح وGUID كمفاتيح أساسية.
   1. بشكل اختياري، غيّر نمط التقسيم‬.
   1. حدد **إغلاق** لحفظ اللوحة وإغلاقها.

1. حدد **حفظ.**. تفتح صفحة **مصادر‏‎ البيانات** التي تعرض مصدر البيانات الجديد في الحالة **جارٍ التحديث**.

   [!INCLUDE [progress-details-include](includes/progress-details-pane.md)]

قد يستغرق تحميل البيانات وقتا. بعد الانتهاء من التحديث بنجاح، يُمكنك مراجعة البيانات المستوعبة من صفحة [**الكيانات**](entities.md).

## <a name="edit-an-azure-data-lake-storage-data-source"></a>تحرير مصدر بيانات Azure Data Lake Storage

يمكنك تحديث الخيار *الاتصال بحساب تخزين باستخدام*. لمزيد من المعلومات، راجع [توصيل Customer Insights بحساب Azure Data Lake Storage Gen2 باستخدام كيان خدمة Azure](connect-service-principal.md). للاتصال بحاوية أخرى من حساب التخزين، أو تغيير اسم الحساب، عليك [إنشاء اتصال مصدر بيانات جديد](#connect-to-azure-data-lake-storage).

1. انتقل إلى **البيانات** > **مصادر البيانات**.

1. إلى جانب مصدر البيانات الذي تريد تحديثه، حدد **تحرير**.

   :::image type="content" source="media/data_sources_edit_ADLS.png" alt-text="مربع الحوار لتحرير مصدر بيانات Azure Data Lake":::

1. قم بتغيير أي من المعلومات التالية:

   - **‏‏الوصف**
   - **توصيل مساحة التخزين باستخدام** ومعلومات الاتصال. لا يمكنك **تغيير** معلومات الحاوية عند تحديث الاتصال.
      > [!NOTE]
      > يجب تعيين أحد الأدوار التالية إلى حساب التخزين أو حاوية التخزين:
        > - قارئ بيانات مخزن البيانات الثنائية الكبيرة
        > - مالك بيانات مخزن البيانات الثنائية الكبيرة
        > - المساهم في بيانات مخزن البيانات الثنائية الكبيرة

   - **تمكين الارتباط الخاص** إذا أردت استيعاب البيانات من حساب تخزين عبر Azure Private Link. لمزيد من المعلومات، راجع [الارتباطات الخاصة](security-overview.md#set-up-an-azure-private-link).

1. حدد **التالي**.
1. قم بتغيير أي مما يلي:
   - تنقل إلى ملف model.json أو manifest.json مختلف مع مجموعة مختلفة من الكيانات من حاوية.
   - لإضافة المزيد من الكيانات لاستيعابها، حدد **كيان جديد**.
   - لإزالة أي كيانات محددة بالفعل في حالة عدم وجود تبعيات، حدد الكيان والخيار **حذف** .
      > [!IMPORTANT]
      > في حال وجود تبعيات على ملف model.json أو manifest.json الموجود وعلى مجموعة الكيانات، فسترى رسالة خطأ ولا يمكنك تحديد ملف model.json أو manifest.json مختلف. يمكنك إزالة هذه التبعيات قبل تغيير الملف model.json أو manifest.json أو إنشاء ملف مصدر بيانات جديد باستخدام الملف model.json أو manifest.json والذي ترغب في استخدامه لتجنب إزالة التبعيات.
   - لتغيير موقع ملف البيانات أو المفتاح الأساسي، حدد **تحرير**.
   - لتغيير بيانات الاستيعاب التزايدي، راجع [تكوين تحديث تزايدي لمصادر بيانات Azure Data Lake](incremental-refresh-data-sources.md).
   - قم بتغيير اسم الكيان فقط لمطابقة اسم الكيان في ملف .json.

     > [!NOTE]
     > احتفظ دائمًا باسم الكيان في Customer Insights بنفس اسم الكيان داخل ملف model.json أو manifest.json بعد الاستيعاب. يتحقق Customer Insights من صحة جميع أسماء الكيانات باستخدام model.json أو manifest.json أثناء كل تحديث للنظام. إذا تم تغيير اسم الكيان إما داخل Customer Insights أو خارجه، فسيحدث خطأ لأن Customer Insights لا يمكنه العثور على اسم الكيان الجديد في ملف .json. إذا تم تغيير اسم الكيان الذي تم إدخاله عن طريق الخطأ، فقم بتحرير اسم الكيان في Customer Insights لمطابقة الاسم الموجود في ملف .json.

1. حدد **سمات** لإضافة سمات أو تغييرها، أو لتمكين تجميع البيانات. ثم حدد **تم**.

1. انقر فوق **حفظ** لتطبيق تغييرات، ثم عد إلى صفحة **مصادر‏‎ البيانات**.

   [!INCLUDE [progress-details-include](includes/progress-details-pane.md)]

## <a name="common-reasons-for-ingestion-errors-or-corrupt-data"></a>الأسباب الشائعة لأخطاء الاستيعاب أو البيانات تالفة

أثناء استيعاب البيانات، تتضمن بعض الأسباب الأكثر شيوعًا لاعتبار أحد السجلات تالفًا:

- عدم تطابق أنواع البيانات وقيم الحقول بين الملف المصدر والمخطط
- عدم تطابق عدد الأعمدة في الملف المصدر مع المخطط
- تحتوي الحقول على أحرف تتسبب في انحراف الأعمدة مقارنةً بالمخطط المتوقع. على سبيل المثال: علامات الاقتباس المنسقة بشكل غير صحيح أو علامات الاقتباس التي لم يتم تجاوزها أو أحرف السطر الجديد أو أحرف علامات جدولة.
- ملفات الأقسام مفقودة
- في حالة وجود أعمدة التاريخ والوقت/التاريخ/datetimeoffset، يجب تحديد تنسيقها في المخطط إذا لم تكن تتبع التنسيق القياسي.

### <a name="schema-or-data-type-mismatch"></a>عدم تطابق المخطط أو نوع البيانات

إذا لم تكن البيانات متوافقة مع المخطط، فيتم إكمال عملية الاستيعاب مع أخطاء. صحح إما مصدر البيانات أو المخطط ثم أعد استيعاب البيانات.

### <a name="partition-files-are-missing"></a>ملفات الأقسام مفقودة

- إذا نجحت عملية الاستيعاب دون أي سجلات تالفة، ولكن لم يكن بمقدورك رؤية أية بيانات، فحرر ملف model.json أو manifest.json للتأكد من تحديد الأقسام. بعد ذلك، اعمل على [تحديث مصدر البيانات](data-sources.md#refresh-data-sources).

- إذا حدثت عملية استيعاب البيانات في نفس الوقت الذي تم فيه تحديث مصادر البيانات أثناء التحديث المجدول التلقائي، فقد تكون ملفات الأقسام فارغة أو غير متوفرة كي تتم معالجتها بواسطة Customer Insights. للمواءمة مع جدول التحديث النهائي، عليك تغيير [جدولة تحديث النظام](schedule-refresh.md) أو جدولة تحديث مصدر البيانات. عليك مواءمة الوقت بحيث لا تحدث التحديثات كلها في وقت واحد وتوفر أحدث البيانات التي تتم معالجتها في Customer Insights.

### <a name="datetime-fields-in-the-wrong-format"></a>حقول التاريخ والوقت بالتنسيق الخاطئ

حقول التاريخ والوقت في الكيان ليست بتنسيقات ISO 8601 أو en-US. تنسيق التاريخ والوقت الافتراضي في Customer Insights هو تنسيق en-US. يجب أن تكون كافة حقول التاريخ والوقت في الكيان بنفس التنسيق. يدعم Customer Insights التنسيقات الأخرى شريطة إنشاء التعليقات أو الخصائص على مستوى المصدر أو الكيان في النموذج أو manifest.json. على سبيل المثال: 

**Model.json**

   ```json
      "annotations": [
        {
          "name": "ci:CustomTimestampFormat",
          "value": "yyyy-MM-dd'T'HH:mm:ss:SSS"
        },
        {
          "name": "ci:CustomDateFormat",
          "value": "yyyy-MM-dd"
        }
      ]   
   ```

  في manifest.json، يمكن تحديد تنسيق التاريخ والوقت على مستوى الكيان أو على مستوى السمة. على مستوى الكيان، استخدم "exhibitsTraits" في الكيان في *.manifest.cdm.json لتحديد تنسيق التاريخ والوقت. على مستوى السمة، استخدم "appliedTraits" في السمة في entityname.cdm.json.

**Manifest.json على مستوى الكيان**

```json
"exhibitsTraits": [
    {
        "traitReference": "is.formatted.dateTime",
        "arguments": [
            {
                "name": "format",
                "value": "yyyy-MM-dd'T'HH:mm:ss"
            }
        ]
    },
    {
        "traitReference": "is.formatted.date",
        "arguments": [
            {
                "name": "format",
                "value": "yyyy-MM-dd"
            }
        ]
    }
]
```

**Manifest.json على مستوى السمة**

```json
   {
      "name": "PurchasedOn",
      "appliedTraits": [
        {
          "traitReference": "is.formatted.date",
          "arguments" : [
            {
              "name": "format",
              "value": "yyyy-MM-dd"
            }
          ]
        },
        {
          "traitReference": "is.formatted.dateTime",
          "arguments" : [
            {
              "name": "format",
              "value": "yyyy-MM-ddTHH:mm:ss"
            }
          ]
        }
      ],
      "attributeContext": "POSPurchases/attributeContext/POSPurchases/PurchasedOn",
      "dataFormat": "DateTime"
    }
```

[!INCLUDE [footer-include](includes/footer-banner.md)]
